{
    "collab_server" : "",
    "contents" : "data1 <- read.csv(\"d:\\\\shops_training27.csv\", header=TRUE)\ndata2 <- read.csv(\"d:\\\\shops_test27.csv\", header=TRUE)\n\n\n#################### 휴일 1\ndata1$anniversary <- ifelse(data1$anniversary == \"평일\", 0, 1)\ndata1$before_anniversary <- ifelse(data1$before_anniversary == \"평일\", 0, 1)\ndata1$after_anniversary <- ifelse(data1$after_anniversary == \"평일\", 0, 1)\n\ndata2$anniversary <- ifelse(data2$anniversary == \"평일\", 0, 1)\ndata2$before_anniversary <- ifelse(data2$before_anniversary == \"평일\", 0, 1)\ndata2$after_anniversary <- ifelse(data2$after_anniversary == \"평일\", 0, 1)\n\ndata1$isHoliday <- ifelse(data1$isHoliday == TRUE, 1, 0)\ndata1$before_isHoliday <- ifelse(data1$before_isHoliday == TRUE, 1, 0)\ndata1$after_isHoliday <- ifelse(data1$after_isHoliday == TRUE, 1, 0)\n\ndata2$isHoliday <- ifelse(data2$isHoliday == TRUE, 1, 0)\ndata2$before_isHoliday <- ifelse(data2$before_isHoliday == TRUE, 1, 0)\ndata2$after_isHoliday <- ifelse(data2$after_isHoliday == TRUE, 1, 0)\n\n#################### 비 안개 1\ndata1$fog <- ifelse(data1$fog == TRUE, 1, 0)\ndata1$rain <- ifelse(data1$rain == TRUE, 1, 0)\n\ndata2$fog <- ifelse(data2$fog == TRUE, 1, 0)\ndata2$rain <- ifelse(data2$rain == TRUE, 1, 0)\n\n\n#################### 범위 18등분\nrange(data1$class_orders)\ndata1_range <- (max(data1$class_orders) - min(data1$class_orders)) / 18\n\nrv <- seq(from = 20, by = data1_range, to = 422)\n\ndata1$class_orders <- as.numeric(cut(data1$class_orders, rv, label = c(1:18)))\ndata2$class_orders <- as.numeric(cut(data2$class_orders, rv, label = c(1:18)))\n\ntable(data1$class_orders)\ntable(data2$class_orders)\n\n\n################## ES_orders\n#range(data2$ES_orders_75)\n#ES75_range <- (max(data1$ES_orders_75) - min(data1$ES_orders_75)) / 5\n#ES75_rv <- seq(from=20, by=ES75_range, to=290)\n\n#data1$ES_orders_75 <- as.numeric(cut(data1$ES_orders_75, ES75_rv, label = c(1:7)))\n#data2$ES_orders_75 <- as.numeric(cut(data2$ES_orders_75, ES75_rv, label = c(1:7)))\n\n\n######################### MAPE\nMAPE <- function(y, exp_y){\n  return( sum(abs(y - exp_y)/y)/length(y) * 100 )\n}\n\n\n######################### Confusion Matrix 출력 및 모델 성능 분석 함수\ncalculate <- function(actual, predicted){ # 패러미터는 모두 벡터\n  \n  predicted <- round(predicted)\n  res <- actual - predicted\n  res_table <- table(res)\n  \n  tp_range <- ifelse(-1 <= res & res <= 1, 1, 0)\n  fp_range <- ifelse(res > 1, 1, 0)\n  fn_range <- ifelse(res < -1, 1, 0)\n  \n  tp <- sum(tp_range) # 실제 값과 일치하며 양수\n  fp <- sum(fp_range) # 불일치 양수 값\n  fn <- sum(fn_range) # 불일치 음수 값\n  \n  P <- tp / (tp + fp)\n  R <- tp / (tp + fn)\n  F_measure <- 2 * R * P / (R+P)\n  \n  # Confusion Matrix\n  conf_matrix <- matrix( c(tp, fp, fn, NA), nrow = 2, ncol = 2)\n  colnames(conf_matrix) = c(\"Forecast = P\", \" N\")\n  rownames(conf_matrix) = c(\"TP FN\", \"FP TN\")\n  \n  cat(\"True Positive  : \", tp, \"\\n\",\n      \"False Positive : \", fp, \"\\n\",\n      \"False Negative : \", fn, \"\\n\\n\",\n      \"-----------------------\\n\",\n      \"Total          : \", length(predicted), \"/\", length(actual), \"\\n\\n\",\n      \n      \"MAPE      : \", MAPE(actual, predicted), \"\\n\",\n      \"Precision : \", P, \"\\n\",\n      \"Recall    : \", R, \"\\n\",\n      \"F-Measure : \", F_measure, \"\\n\\n\")\n  \n  return (conf_matrix)\n  \n}\n\ninstall.packages(\"tree\")\nlibrary(tree)\n\nattach(data1)\n\nmytree <- tree(class_orders~ isHoliday\n               + anniversary\n               #+ month\n               #+ weekday\n               #+ day\n               + holiday_order\n               + rain\n               + fog\n               + temp_highest\n               #+ LYSM_similarDates_avg_orders\n               #+ prediction_orders\n               #+ ES_orders_25\n               + ES_orders_75\n               #+ similarDates_movingAvg_orders\n               #+ currentFamilySavingCSI\n               #+ underlyingInflationRate\n               #+ importChangeRate\n               #+ football_national_cnt\n               + naverTrend_Shop_lastweek\n               ,data1)\n\nplot(mytree)\ntext(mytree, all = T)\n\npred <- predict(mytree, newdata = data2)\npred_round <- round(pred)\n\ntable(data2$class_orders - pred_round)\n\ncalculate(data2$class_orders, pred)\n",
    "created" : 1480923914030.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3320433240",
    "id" : "3745A9D4",
    "lastKnownWriteTime" : 1481023055,
    "last_content_update" : 1481023055,
    "path" : "C:/Users/juyeon/Desktop/R/13주차/13주차/다다다시.R",
    "project_path" : "다다다시.R",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}